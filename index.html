<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—¥ç³»æ¥µç°¡è‡ªå¾‹æ‰“å¡ App</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/lucide@0.277.0/dist/lucide.esm.js"></script>
  <!-- Canvas Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    body { background: #FFFFFF; font-family: sans-serif; }
    .card { border: 2px solid #065f46; box-shadow: 6px 6px 0 #065f46; border-radius: 1.5rem; }
    .status-indicator { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .nav-item { flex: 1; text-align: center; }
    .nav-fixed { position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%); width: 90%; background: #FFFFFF; border-radius: 1.5rem; box-shadow: 6px 6px 0 #065f46; display: flex; justify-content: space-around; padding: 8px 0; }
    .btn-press { transition: transform 0.1s; }
    .btn-press:active { transform: translateY(2px); box-shadow: 3px 3px 0 #065f46; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Dashboard -->
  <div id="dashboard" class="flex-1 p-4 space-y-4">
    <!-- Header -->
    <div class="flex justify-between items-center">
      <h1 class="text-xl font-bold text-[#065f46]">è‡ªå¾‹æ‰“å¡</h1>
      <div class="w-12 h-12 rounded-xl bg-[#065f46] flex items-center justify-center text-white cursor-pointer" id="profile-btn">ğŸ‘¤</div>
    </div>

    <!-- æœ¬é€±ç´¯è¨ˆå¡ç‰‡ -->
    <div class="card p-4 flex justify-between items-center bg-white">
      <span class="font-semibold text-[#065f46]">æœ¬é€±ç´¯è¨ˆ</span>
      <span id="weekly-total" class="text-2xl font-black text-[#FACC15]">0 min</span>
    </div>

    <!-- å°ˆæ¡ˆç‹€æ…‹å¡ç‰‡ -->
    <div class="card p-4 space-y-2 bg-white">
      <div class="flex justify-between items-center">
        <span class="font-semibold text-[#065f46]" id="project-name">ç·´åŠŸ</span>
        <span class="font-bold text-[#065f46]" id="project-count">0 æ¬¡</span>
      </div>
      <div class="flex justify-between" id="week-status">
        <div class="status-indicator bg-gray-200">æ—¥</div>
        <div class="status-indicator bg-gray-200">ä¸€</div>
        <div class="status-indicator bg-gray-200">äºŒ</div>
        <div class="status-indicator bg-gray-200">ä¸‰</div>
        <div class="status-indicator bg-gray-200">å››</div>
        <div class="status-indicator bg-gray-200">äº”</div>
        <div class="status-indicator bg-gray-200">å…­</div>
      </div>
    </div>
  </div>

  <!-- æ‰“å¡æŒ‰éˆ• -->
  <button id="log-btn" class="btn-press fixed bottom-40 left-1/2 transform -translate-x-1/2 w-11/12 py-4 bg-[#beff64] text-[#065f46] font-bold text-xl rounded-3xl border-2 border-[#065f46] shadow-[6px_6px_0_#065f46]">
    + æ‰“å¡
  </button>

  <!-- åº•éƒ¨å°è¦½åˆ— -->
  <div class="nav-fixed">
    <div class="nav-item" onclick="showPage('dashboard')">
      <span class="block">ğŸ </span>
      <span class="text-sm text-[#065f46]">é¦–é </span>
    </div>
    <div class="nav-item" onclick="showPage('calendar')">
      <span class="block">ğŸ“…</span>
      <span class="text-sm text-[#065f46]">æ—¥æ›†</span>
    </div>
    <div class="nav-item" onclick="showPage('ranking')">
      <span class="block">ğŸ†</span>
      <span class="text-sm text-[#065f46]">æ’è¡Œæ¦œ</span>
    </div>
    <div class="nav-item" onclick="showPage('profile')">
      <span class="block">ğŸ‘¤</span>
      <span class="text-sm text-[#065f46]">å€‹äºº</span>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD9KAWLvPjTOIoImxobugT6dQUbQmJiCGg",
      authDomain: "actiongame-7c8c9.firebaseapp.com",
      projectId: "actiongame-7c8c9",
      storageBucket: "actiongame-7c8c9.appspot.com",
      messagingSenderId: "386021872588",
      appId: "1:386021872588:web:eb6019fa0a182d3aec4369",
      measurementId: "G-W6CNY1D4RL"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userId = null;

    async function login() {
      const provider = new GoogleAuthProvider();
      const result = await signInWithPopup(auth, provider);
      userId = result.user.uid;
      loadUserData();
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        userId = user.uid;
        loadUserData();
      } else {
        login();
      }
    });

    async function loadUserData() {
      const docRef = doc(db, "users", userId);
      const docSnap = await getDoc(docRef);
      if (!docSnap.exists()) {
        await setDoc(docRef, {
          weeklyTotal: 0,
          projects: { "ç·´åŠŸ": Array(7).fill(false) }
        });
      }
      updateUI();
    }

    async function updateUI() {
      const docRef = doc(db, "users", userId);
      const docSnap = await getDoc(docRef);
      const data = docSnap.data();
      const project = "ç·´åŠŸ";
      document.getElementById("weekly-total").textContent = `${data.weeklyTotal} min`;
      document.getElementById("project-count").textContent = `${data.projects[project].filter(v=>v).length} æ¬¡`;
      const weekStatus = document.getElementById("week-status").children;
      data.projects[project].forEach((done, i) => {
        weekStatus[i].textContent = done ? "ğŸ˜Š" : ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][i];
        weekStatus[i].style.background = done ? "#FACC15" : "gray";
      });
    }

    document.getElementById("log-btn").addEventListener("click", async () => {
      const docRef = doc(db, "users", userId);
      const docSnap = await getDoc(docRef);
      const data = docSnap.data();
      const project = "ç·´åŠŸ";
      const today = new Date().getDay(); // 0(æ—¥)~6(å…­)
      if (!data.projects[project][today]) {
        data.projects[project][today] = true;
        data.weeklyTotal += 5; // æ¯æ¬¡æ‰“å¡å¢åŠ  5 åˆ†é˜
        await updateDoc(docRef, data);
        updateUI();
        confetti({ colors: ['#beff64','#FACC15'] });
      }
    });

    function showPage(page) {
      alert("åˆ‡æ›é é¢åŠŸèƒ½å°šæœªå®Œæˆï¼Œæœ¬ç¯„ä¾‹ä»¥ Dashboard ç‚ºä¸»å±•ç¤ºã€‚");
    }
  </script>
</body>
</html>
