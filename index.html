<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>自律動起來 - 日曆紀錄版</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style type="text/tailwindcss">
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        @layer utilities {
            .neo-border { @apply border-2 border-[#065f46]; }
            .neo-shadow { box-shadow: 6px 6px 0px 0px #065f46; }
            .neo-shadow-sm { box-shadow: 4px 4px 0px 0px #065f46; }
            .active-press { @apply active:translate-x-[2px] active:translate-y-[2px] active:shadow-none transition-all; }
            .overlay-blur { backdrop-filter: blur(4px); background-color: rgba(6, 95, 70, 0.4); }
        }
        body { font-family: 'Noto Sans TC', sans-serif; @apply bg-[#f0fdf4] text-gray-800; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 24, className = "", strokeWidth = 3 }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    ref.current.innerHTML = '';
                    const icon = window.lucide.icons[name];
                    if (icon) {
                        const el = window.lucide.createElement(icon);
                        el.setAttribute('width', size);
                        el.setAttribute('height', size);
                        el.setAttribute('stroke-width', strokeWidth);
                        ref.current.appendChild(el);
                    }
                }
            }, [name, size, strokeWidth]);
            return <span ref={ref} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        const Calendar = () => {
            const today = new Date();
            const [currentMonth, setCurrentMonth] = useState(new Date());
            
            // 獲取該月天數與起始星期
            const daysInMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();
            const firstDayOfMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay();
            
            // 模擬已打卡日期（例如 1, 5, 12, 18, 22 號）
            const dummyLogDates = [1, 5, 12, 18, 22];

            const days = [];
            for (let i = 0; i < firstDayOfMonth; i++) days.push(null);
            for (let d = 1; d <= daysInMonth; d++) days.push(d);

            const changeMonth = (offset) => {
                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + offset, 1));
            };

            return (
                <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="bg-white p-6 rounded-[2rem] neo-border neo-shadow">
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => changeMonth(-1)} className="p-2 neo-border rounded-xl active-press"><Icon name="ChevronLeft" /></button>
                            <h2 className="text-2xl font-black text-[#065f46]">
                                {currentMonth.getFullYear()}年 {currentMonth.getMonth() + 1}月
                            </h2>
                            <button onClick={() => changeMonth(1)} className="p-2 neo-border rounded-xl active-press"><Icon name="ChevronRight" /></button>
                        </div>

                        <div className="grid grid-cols-7 gap-2">
                            {['日', '一', '二', '三', '四', '五', '六'].map(d => (
                                <div key={d} className="text-center font-black text-[#065f46] opacity-40 text-xs py-2">{d}</div>
                            ))}
                            {days.map((day, idx) => {
                                const isLogged = dummyLogDates.includes(day);
                                const isToday = day === today.getDate() && currentMonth.getMonth() === today.getMonth();
                                
                                return (
                                    <div 
                                        key={idx} 
                                        className={`aspect-square rounded-xl neo-border flex flex-col items-center justify-center relative transition-all
                                            ${day === null ? 'border-none' : ''}
                                            ${isLogged ? 'bg-[#beff64] neo-shadow-sm' : 'bg-white'}
                                            ${isToday ? 'ring-4 ring-[#065f46] ring-inset' : ''}
                                        `}
                                    >
                                        {day && (
                                            <>
                                                <span className={`text-sm font-black ${isLogged ? 'text-[#065f46]' : 'text-gray-400'}`}>{day}</span>
                                                {isLogged && <Icon name="Smile" size={14} className="mt-1 text-[#065f46]" />}
                                            </>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="bg-[#beff64] p-6 rounded-[2rem] neo-border neo-shadow-sm">
                        <h3 className="font-black text-[#065f46]">本月自律統計</h3>
                        <div className="flex justify-between mt-4">
                            <div className="text-center">
                                <div className="text-2xl font-black text-[#065f46]">15</div>
                                <div className="text-[10px] font-bold opacity-60">打卡天數</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-black text-[#065f46]">85%</div>
                                <div className="text-[10px] font-bold opacity-60">完成率</div>
                            </div>
                            <div className="text-center">
                                <div className="text-2xl font-black text-[#065f46]">5</div>
                                <div className="text-[10px] font-bold opacity-60">連續紀錄</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user] = useState({ displayName: "自律者", photoURL: "https://api.dicebear.com/7.x/avataaars/svg?seed=Lucky" });
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isModalOpen, setIsModalOpen] = useState(false);

            return (
                <div className="max-w-md mx-auto min-h-screen bg-[#f0fdf4] relative pb-32">
                    <header className="bg-white px-6 py-5 flex justify-between items-center neo-border border-t-0 border-x-0">
                        <div className="flex items-center space-x-2 text-[#065f46]">
                            <Icon name="Smile" size={28} />
                            <span className="text-xl font-black uppercase">Self-Discipline</span>
                        </div>
                        <img src={user.photoURL} className="w-10 h-10 rounded-xl neo-border" />
                    </header>

                    <main className="p-6">
                        {activeTab === 'dashboard' ? (
                            /* 原本的首頁內容... (簡略顯示) */
                            <div className="space-y-4">
                                <div className="bg-white p-6 rounded-[2rem] neo-border neo-shadow-sm">
                                    <h2 className="text-xl font-black text-[#065f46]">你好，{user.displayName}</h2>
                                    <p className="text-gray-400 font-bold text-sm">點擊下方按鈕開始打卡！</p>
                                </div>
                                <button onClick={() => setIsModalOpen(true)} className="w-full bg-[#beff64] p-6 rounded-[2rem] neo-border neo-shadow active-press flex items-center justify-center gap-3">
                                    <Icon name="Zap" /> <span className="font-black text-[#065f46] text-xl">＋ 今日打卡</span>
                                </button>
                            </div>
                        ) : activeTab === 'calendar' ? (
                            <Calendar />
                        ) : (
                            <div className="text-center py-20 font-black text-[#065f46] opacity-20 text-3xl italic">COMING SOON</div>
                        )}
                    </main>

                    {/* 這裡省略了打卡彈窗與導覽按鈕的重複部分，實際程式碼中請保留 */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] bg-white neo-border rounded-full p-2 flex justify-around neo-shadow z-20">
                        <NavBtn active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon="LayoutGrid" />
                        <NavBtn active={activeTab === 'calendar'} onClick={() => setActiveTab('calendar')} icon="Calendar" />
                        <NavBtn active={activeTab === 'ranking'} onClick={() => setActiveTab('ranking')} icon="Trophy" />
                        <NavBtn active={activeTab === 'profile'} onClick={() => setActiveTab('profile')} icon="User" />
                    </nav>
                </div>
            );
        };

        const NavBtn = ({ active, onClick, icon }) => (
            <button onClick={onClick} className={`p-4 rounded-full transition-all ${active ? 'bg-[#beff64] neo-border' : 'opacity-20'}`}>
                <Icon name={icon} size={24} className="text-[#065f46]" />
            </button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
